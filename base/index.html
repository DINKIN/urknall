<!DOCTYPE HTML>
<html lang="en">
<head>
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Urknall Documentation - </title>
<link href="../css/stylesheet.css" media="screen" rel="stylesheet" type="text/css">
<link href="../css/pygments.css" media="screen" rel="stylesheet" type="text/css">

<!-- Bootstrap -->
<link href="../css/bootstrap.min.css" rel="stylesheet">

<!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
<!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
<!--[if lt IE 9]>
		<script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
		<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
	<![endif]-->

<!-- you don't need to keep this, but it's cool for stats! -->
<meta name="generator" content="nanoc 3.7.2">
</head>



<body>
<div class="navbar navbar-inverse navbar-fixed-top" role="navigation">
	<div class="container">
		<div class="navbar-header">
			<button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
				<span class="sr-only">Toggle navigation</span>
				<span class="icon-bar"></span>
				<span class="icon-bar"></span>
				<span class="icon-bar"></span>
			</button>
			<a class="navbar-brand" href="../">Urknall Documentation</a>
		</div>
		<div class="collapse navbar-collapse">
			<ul class="nav navbar-nav">
				<li><a href="../docs/quickstart/">QuickStart</a></li>
				<li><a href="../docs/library/">Library</a></li>
				<li><a href="../docs/binary/">Binary</a></li>
			</ul>
		</div><!--/.nav-collapse -->
	</div>
</div>




<div class="container">

<p><a href="http://urknall.dynport.de/">urknall</a> is a library written in go for the automated provisioning of servers.</p>

<p>The primary use case for urknall is automated execution of commands on linux (ubuntu) hosts, either locally or via ssh.</p>

<p>urknall does not require any extra software to be installed on the target host (except bash) and has no dependencies. It’s designed to be used and shipped as a custom-built standalone binary (executable).</p>

<p>urknall <strong>is not a framework</strong> but a library. There is no (and probably never will be) <code>urknall provision &lt;my host&gt;</code> binary. We are also keen on providing building blocks that simplify the life of developers and system operators rather than giving out blueprint-recipes for complex setups that will hardly ever fit their needs completely.</p>

<p>To use urknall you need start with creating a <strong>custom go application</strong> (either binary or script) and adding the commands which are executed on targets step by step.</p>

<h2 id="philosophy">Philosophy</h2>

<p>The philosophy behind urknall reflects our design choices while building urknall and improving it over time. We do not deem them to be exclusive or even objective, but it’s the principles and ideas our team shares about provisioning and software design.</p>

<h3 id="single-binary-executable">Single binary (executable)</h3>

<p>All necessary resources (except e.g. credentials) should be compiled into a single, statically linked binary.</p>

<p>Examples:</p>

<ul>
  <li>configuration templates</li>
  <li>recipes/cookbooks/playbooks/etc.</li>
  <li>template -&gt; target mappings (see Building Blocks)</li>
</ul>

<p>To allow your teammates to provision a new server you only need to share one single binary. There should be no need to install any software (ruby, python, etc.), libraries (gems, pip packages, etc) or have a checkout of a repository for config templates.</p>

<p>You can (and should) add checks which make sure that you always use the most recent version of the binary (to avoid regressions) by e.g. validating the build revision of the binary with a remote service. Having a single file to maintain reduces the complexity of this chure.</p>

<h3 id="type-safety">Type safety</h3>
<p>Infrastructure should be describe in a type safe programming language.</p>

<ul>
  <li>compiler support: catch bugs/typos/etc early (even before doing any provisioning)</li>
  <li>easier refactorings, cleaning up, drying up of your configuration</li>
  <li>reduce duplication and clutter</li>
</ul>

<p><strong>YAML is neither type safe, nor a programming language</strong></p>

<p>Choosing a purely declarative or even domain specific language approach to infrastructure definition leaves room for interpretation and therefor misunderstanding. We try to stick to the go basics.</p>

<h3 id="pragmatic">Pragmatic</h3>

<p>urknall Templates (see Buildling Blocks) should not be too generic. They should not include all the nobs to configure your database server. They should also not support multiple linux distributions as you will rarely need to switch your OS platform. If you feel that need, urknall is not the right library for you.</p>

<h2 id="building-blocks">Building Blocks</h2>

<h3 id="build">Build</h3>

<p>Execution of a <code>template</code> on a <code>target</code></p>

<h3 id="target">Target</h3>

<p>Host to be provisioned (remote (via ssh) or local)</p>

<h3 id="template">Template</h3>

<ul>
  <li>holds variables</li>
  <li>is rendered to <code>packages</code>
</li>
</ul>

<h3 id="package">Package</h3>

<ul>
  <li>list of <code>tasks</code>
</li>
</ul>

<h3 id="task">Task</h3>

<ul>
  <li>list of <code>commands</code>
</li>
  <li>has unique name (used for Caching)</li>
  <li>unit of caching (see Caching)</li>
</ul>

<h3 id="command">Command</h3>

<ul>
  <li>atomic-ish* linux command</li>
</ul>

<p>Examples:</p>

<ul>
  <li>install system packages</li>
  <li>write a file to disk</li>
  <li>download the source of a package</li>
</ul>

<p>* e.g. the WriteFile command executes these steps: write file + change owner + change mode</p>

<h2 id="caching">Caching</h2>

<p>urknall uses statement-based caching (similar to building docker images) on a <code>task</code> level. </p>

<p>The checksums of all commands that are executed for a task are written into a tree structure <strong>on the target</strong>. The next time a task is supposed to be executed on a target the current checksums of the task are compared with the checksums of already executed commands on the target. If the checksum of a command changes all commands including that command will be re-executed and the tree is updated. Unchanged commands before the first changed command will not be executed again.</p>

<h2 id="hello-world">Hello world</h2>

<p>This is the “hello world” of urknall. This program can be either executed with <code>go run &lt;file.go&gt;</code> or compiled to a binary <code>go build -o ./urknall-test &lt;file.go&gt;</code>.</p>

<pre><code>package main

import (
  "log"
  "os"

  "github.com/dynport/urknall"
)

func main() {
  if e := provision(); e != nil {
    log.Fatal(e)
  }
}

type command struct {
  cmd string
}

func (c *command) Shell() string {
  return c.cmd
}

func provision() error {
  // setup logging to stdout
  defer urknall.OpenLogger(os.Stdout).Close()

  // create a basic urknall.Template
  // executes "echo hello world" as user ubuntu on the provided host
  tpl := urknall.TemplateFunc(func(p urknall.Package) {
    p.AddCommands("run", &amp;command{cmd: "echo hello world"})
  })

  // create provisioning target for provisioning via ssh with
  // user=ubuntu
  // host=172.16.223.142
  // password=ubuntu
  target, e := urknall.NewSshTargetWithPassword("ubuntu@172.16.223.142", "ubuntu")
  if e != nil {
    return e
  }
  return urknall.Run(target, tpl)
}
</code></pre>

<p>When compiled to a binary this program <strong>does not need any runtime dependencies</strong> as go statically links all dependencies.</p>

<h2 id="more-examples">More Examples</h2>

<p>See <a href="examples">examples</a> for a list of more advanced examples.</p>

</div>


<hr/>

<footer>
<div class="container">
	<p>© <a href="http://www.dynport.de" target="_blank">Dynport GmbH</a> 2014</p>
</div>
</footer>


<!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>
<!-- Include all compiled plugins (below), or include individual files as needed -->
<script src="../js/bootstrap.min.js"></script>
</body>
</html>
